{
	"project": "Backlog.md Spaghetti Refactor",
	"phase": "Phase 1: Milestone Resolution Deduplication",
	"planFile": "docs/plans/2026-02-19-phase1-milestone-dedup-implementation.md",
	"designFile": "docs/plans/2026-02-19-spaghetti-refactor-design.md",
	"branch": "main",
	"baseCommit": "0f1a761",
	"lastCommit": "c5610d5",
	"date": "2026-02-19",
	"overallProgress": {
		"phase1_milestonDedup": "in_progress",
		"phase2_fileSystemSplit": "not_started",
		"phase3_coreDecomposition": "not_started",
		"phase4_serverSplit": "completed"
	},
	"phase1Tasks": [
		{
			"id": "task-1",
			"title": "Export buildMilestoneAliasMap and canonicalizeMilestoneValue from core",
			"status": "completed",
			"commit": "9705599",
			"files": ["src/core/milestones.ts"]
		},
		{
			"id": "task-2",
			"title": "Add resolveMilestoneInput to core/milestones.ts",
			"status": "completed",
			"commit": "5ceaca0",
			"files": ["src/core/milestones.ts"]
		},
		{
			"id": "task-3",
			"title": "Re-export new functions from web/utils/milestones.ts",
			"status": "completed",
			"commit": "114db4a",
			"files": ["src/web/utils/milestones.ts"]
		},
		{
			"id": "task-4",
			"title": "Replace server/index.ts private resolveMilestoneInput",
			"status": "pending",
			"description": "Delete private 120-line method (lines 98-218). Import resolveMilestoneInput from core/milestones.ts. Callers need to load milestones first via core.filesystem.listMilestones() and listArchivedMilestones(), then call the shared function.",
			"files": ["src/server/index.ts"]
		},
		{
			"id": "task-5",
			"title": "Replace mcp/tools/tasks/handlers.ts private resolveMilestoneInput",
			"status": "pending",
			"description": "Delete private method (lines 55-159). Import resolveMilestoneInput from ../../../core/milestones.ts. Same pattern as task-4: callers load milestones first.",
			"files": ["src/mcp/tools/tasks/handlers.ts"]
		},
		{
			"id": "task-6",
			"title": "Replace mcp/tools/milestones/handlers.ts resolveMilestoneValueForReporting",
			"status": "pending",
			"description": "Delete resolveMilestoneValueForReporting function (lines 109-195). Import resolveMilestoneInput from core. Keep findActiveMilestoneByAlias and buildTaskMatchKeysForMilestone as-is (different purpose).",
			"files": ["src/mcp/tools/milestones/handlers.ts"]
		},
		{
			"id": "task-7",
			"title": "Replace commands/board.ts inline resolveMilestoneAlias",
			"status": "pending",
			"description": "Delete inline resolveMilestoneAlias function (lines 50-131). Import resolveMilestoneInput from core. Replace milestoneKey(resolveMilestoneAlias(task.milestone)) with milestoneKey(resolveMilestoneInput(task.milestone ?? '', milestoneEntities, archivedMilestones)).",
			"files": ["src/commands/board.ts"]
		},
		{
			"id": "task-8",
			"title": "Replace web/lib/lanes.ts duplicate buildMilestoneAliasMap",
			"status": "pending",
			"description": "Delete local buildMilestoneAliasMap (lines 21-130) and canonicalizeMilestone (line 132+). Import from ../utils/milestones. Replace canonicalizeMilestone calls with canonicalizeMilestoneValue.",
			"files": ["src/web/lib/lanes.ts"]
		},
		{
			"id": "task-9",
			"title": "Replace web/App.tsx duplicate buildMilestoneAliasMap",
			"status": "pending",
			"description": "Delete local buildMilestoneAliasMap function (lines 34-100+). Import from ./utils/milestones. Replace local canonicalizeMilestone with canonicalizeMilestoneValue.",
			"files": ["src/web/App.tsx"]
		},
		{
			"id": "task-10",
			"title": "Replace web/components/Board.tsx inline milestoneAliasToCanonical",
			"status": "pending",
			"description": "Replace ~110 line useMemo block (lines 53-163) with: useMemo(() => buildMilestoneAliasMap(milestoneEntities, archivedMilestones), [milestoneEntities, archivedMilestones]). Replace local canonicalizeMilestone with canonicalizeMilestoneValue.",
			"files": ["src/web/components/Board.tsx"]
		},
		{
			"id": "task-11",
			"title": "Replace web/components/TaskList.tsx inline milestoneAliasToCanonical",
			"status": "pending",
			"description": "Same pattern as Board.tsx. Replace ~107 line useMemo (lines 77-185) with buildMilestoneAliasMap import. Replace canonicalizeMilestone with canonicalizeMilestoneValue.",
			"files": ["src/web/components/TaskList.tsx"]
		},
		{
			"id": "task-12",
			"title": "Replace web/components/TaskDetailsModal.tsx inline resolveMilestoneToId",
			"status": "pending",
			"description": "Replace ~76 line useCallback (lines 87-163) with: resolveMilestoneInput(normalized, milestoneEntities ?? [], archivedMilestoneEntities ?? []). Also replace resolveMilestoneLabel with getMilestoneLabel.",
			"files": ["src/web/components/TaskDetailsModal.tsx"]
		},
		{
			"id": "task-13",
			"title": "Final verification - tests, types, lint, duplicate check",
			"status": "pending",
			"description": "Run CLAUDECODE=1 bun test --timeout 180000, bunx tsc --noEmit, bun run check . Verify no remaining inline milestone resolution patterns.",
			"files": []
		}
	],
	"sharedContext": {
		"coreCanonicalFile": "src/core/milestones.ts",
		"webReExportFile": "src/web/utils/milestones.ts",
		"mcpReExportFile": "src/mcp/utils/milestone-resolution.ts",
		"keyFunctions": {
			"resolveMilestoneInput": "Synchronous. Takes (input, activeMilestones, archivedMilestones?). Returns canonical milestone ID.",
			"buildMilestoneAliasMap": "Takes (milestoneEntities, archivedMilestones?). Returns Map<alias, canonicalId>.",
			"canonicalizeMilestoneValue": "Takes (value, aliasMap). Returns resolved ID using the alias map.",
			"milestoneKey": "Takes (name?). Returns lowercase normalized key for comparison.",
			"normalizeMilestoneName": "Takes (name). Returns trimmed name."
		},
		"importPatterns": {
			"serverAndCLI": "import { resolveMilestoneInput } from '../core/milestones.ts'",
			"mcpHandlers": "import { resolveMilestoneInput } from '../../../core/milestones.ts'",
			"webComponents": "import { buildMilestoneAliasMap, canonicalizeMilestoneValue, resolveMilestoneInput } from '../utils/milestones'"
		},
		"verificationCommands": ["CLAUDECODE=1 bun test --timeout 180000", "bunx tsc --noEmit", "bun run check ."],
		"preExistingIssues": "31 TypeScript errors in agent-instructions.ts, board.ts and related tests - unrelated to milestone work"
	},
	"resumeInstructions": "Continue from task-4. Read docs/plans/2026-02-19-phase1-milestone-dedup-implementation.md for full task details. Each task: make the change, run tests, type check, commit. Use subagent-driven-development skill for execution."
}
